name: Daily Stock Update

on:
  schedule:
    # æ¯å¤©å°ç£æ™‚é–“ä¸‹åˆ 4:00 åŸ·è¡Œ (UTC 08:00)
    - cron: '0 8 * * *'
  workflow_dispatch: # å…è¨±æ‰‹å‹•é»æ“ŠæŒ‰éˆ•åŸ·è¡Œ

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4
      with:
        ref: main

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run screener script
      run: |
        python main.py

    # ğŸ”¥ ä¿®æ­£ï¼šæ”¹å›ä½¿ç”¨åŸç”Ÿ Git æŒ‡ä»¤ï¼Œä¸¦åŠ å…¥ pull --rebase é˜²æ­¢è¡çªèˆ‡è¶…æ™‚
    - name: Commit and Push changes
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add index.html
        
        # æª¢æŸ¥æ˜¯å¦æœ‰è®Šæ›´ï¼Œæ²’è®Šæ›´å°±ä¸åŸ·è¡Œ Commit (é¿å…å ±éŒ¯)
        if git diff --staged --quiet; then
          echo "No changes to commit"
          exit 0
        fi
        
        git commit -m "Auto-update stock data $(date)"
        
        # é—œéµï¼šä¸Šå‚³å‰å…ˆåŒæ­¥ï¼Œè§£æ±ºå¤šäººç·¨è¼¯é€ æˆçš„è¡çª
        git pull --rebase
        
        # å˜—è©¦ä¸Šå‚³
        git push
